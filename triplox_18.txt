Input
  StopPts(10.0); AlvoFinal(40.0); pMediaCurta(20); pMedia60min(240); nLotes(3);

Var
  vMME20, vMME240, vHiLo : Float;
  vUltimaBarra : Integer;
  bJanelaSujeira : Boolean;

Begin
  vMME20 := MediaExp(pMediaCurta, Close);
  vMME240 := MediaExp(pMedia60min, Close);
  vHiLo := HiloActivator(4);

  // DEFINIÇÃO DAS JANELAS DE SUJEIRA (PTAX)
  bJanelaSujeira := ((Time >= 0955) and (Time <= 1005)) or 
                    ((Time >= 1055) and (Time <= 1105)) or
                    ((Time >= 1155) and (Time <= 1205));

  // Lógica Visual
  if (bJanelaSujeira) then 
     PaintBar(clYellow) // AMARELO: Janela de Sujeira (Não Operar)
  else if (Close > vMME20) and (Close > vMME240) and (Close > vHiLo) then 
     PaintBar(clGreen)
  else if (Close < vMME20) and (Close < vMME240) and (Close < vHiLo) then 
     PaintBar(clRed)
  else 
     PaintBar(clWhite);

  // Execução com Filtro de Horário e Janela
  if (BuyPosition = 0) and (CurrentBar > (vUltimaBarra + 1)) and (Not bJanelaSujeira) then
  begin
    if (Time >= 0910) and (Time < 1150) then
    begin
       if (Close > vMME20) and (Close > vMME240) and (Close > vHiLo) then BuyAtMarket(nLotes);
    end;
  end;

  if (BuyPosition > 0) then
  begin
    SellToCoverStop(BuyPrice - StopPts, BuyPrice - StopPts, BuyPosition);
    SellToCoverLimit(BuyPrice + AlvoFinal, BuyPosition);
  end;

  if (BuyPosition[1] > 0) and (BuyPosition = 0) then vUltimaBarra := CurrentBar;
End;