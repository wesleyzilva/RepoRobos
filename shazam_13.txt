Input
  StopPts(6.0);         
  AlvoPts(18.0);        
  BreakevenPts(5.0);    
  QtdeContratos(5);     

Var
  vFibo618      : Float;
  vMaxH1, vMinH1: Float;
  vPrecoEntrada : Float;

Begin
  // 1. Definição do Panorama (Última 1 hora = 12 candles de 5 min)
  vMaxH1 := Highest(High, 12); 
  vMinH1 := Lowest(Low, 12);  
  
  // 2. Cálculo da Zona de Ouro (Retração de 61.8%)
  vFibo618 := vMaxH1 - ((vMaxH1 - vMinH1) * 0.618);

  // 3. Desenho da Linha (Cor corrigida para padrão RGB/Constante)
  Plot(vFibo618);
  SetPlotColor(1, RGB(255,215,0)); // Cor Ouro (Gold) via RGB para evitar erro
  SetPlotWidth(1, 2);

  // 4. Execução de Ordens
  if (Time >= 0900) and (Time < 1530) then
  begin
    
    // Gatilho de Compra
    if (BuyPosition = 0) and (Low <= vFibo618) then
    begin
      BuyLimit(vFibo618, QtdeContratos);
    end;

    // 5. Gestão de Risco (Sintaxe Corrigida)
    if (BuyPosition > 0) then
    begin
      vPrecoEntrada := BuyPrice;

      // Alvo 3:1 (18 pontos) - Usando SellShortLimit para fechar compra
      SellShortLimit(vPrecoEntrada + AlvoPts, QtdeContratos);
      
      // Stop Loss (6 pontos) - Usando SellShortStop para fechar compra
      SellShortStop(vPrecoEntrada - StopPts, vPrecoEntrada - StopPts, QtdeContratos);

      // Regra de Breakeven Automático
      if (Close >= vPrecoEntrada + BreakevenPts) then
      begin
         SellShortStop(vPrecoEntrada + 0.5, vPrecoEntrada + 0.5, QtdeContratos);
      end;
    end;
    
  end;

  // 6. Fechamento Compulsório
  if (Time >= 1530) then ClosePosition;

End;